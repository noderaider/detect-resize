<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/index.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/noderaider/detect-resize" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addResizeListener">addResizeListener</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeResizeListener">removeResizeListener</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
* Detect Element Resize.
* Forked in order to guard against unsafe &apos;window&apos; and &apos;document&apos; references by react-virtualized project.
* ES6ified and npmified by @noderaider.
*
* https://github.com/sdecima/javascript-detect-element-resize
* Sebastian Decima
*
* version: 0.5.3
**/

// Check `document` and `window` in case of server-side rendering
const IS_BROWSER = typeof window === &apos;object&apos;
const getWindow = () =&gt; IS_BROWSER ? window : global
const _window = getWindow()


const attachEvent = IS_BROWSER ? document.attachEvent : false
let stylesCreated = false

if (IS_BROWSER &amp;&amp; !attachEvent) {
  const requestFrame = (function() {
    let raf = _window.requestAnimationFrame || _window.mozRequestAnimationFrame || _window.webkitRequestAnimationFrame || (fn =&gt; setTimeout(fn, 20))
    return fn =&gt; raf(fn)
  })()

  const cancelFrame = (function() {
    let cancel = _window.cancelAnimationFrame || _window.mozCancelAnimationFrame || _window.webkitCancelAnimationFrame || _window.clearTimeout
    return id =&gt; cancel(id)
  })()

  const resetTriggers = function(element) {
    let triggers = element.__resizeTriggers__
    let expand = triggers.firstElementChild
    let contract = triggers.lastElementChild
    let expandChild = expand.firstElementChild
    contract.scrollLeft = contract.scrollWidth
    contract.scrollTop = contract.scrollHeight
    expandChild.style.width = expand.offsetWidth + 1 + &apos;px&apos;
    expandChild.style.height = expand.offsetHeight + 1 + &apos;px&apos;
    expand.scrollLeft = expand.scrollWidth
    expand.scrollTop = expand.scrollHeight
  }

  const checkTriggers = element =&gt; element.offsetWidth != element.__resizeLast__.width || element.offsetHeight != element.__resizeLast__.height
  const scrollListener = function(e){
    let element = this
    resetTriggers(this)
    if (this.__resizeRAF__) cancelFrame(this.__resizeRAF__)
    this.__resizeRAF__ = requestFrame(function(){
      if (checkTriggers(element)) {
        element.__resizeLast__.width = element.offsetWidth
        element.__resizeLast__.height = element.offsetHeight
        element.__resizeListeners__.forEach(function(fn){
          fn.call(element, e)
        })
      }
    })
  }

  /* Detect CSS Animations support to detect element display/re-attach */
  let animation = false
  let animationstring = &apos;animation&apos;
  let keyframeprefix = &apos;&apos;
  let animationstartevent = &apos;animationstart&apos;
  let domPrefixes = &apos;Webkit Moz O ms&apos;.split(&apos; &apos;)
  let startEvents = &apos;webkitAnimationStart animationstart oAnimationStart MSAnimationStart&apos;.split(&apos; &apos;)
  let pfx  = &apos;&apos;
  const elm = document.createElement(&apos;fakeelement&apos;)
  if( typeof elm.style.animationName !== &apos;undefined&apos; ) animation = true

  if(animation === false) {
    for( var i = 0; i &lt; domPrefixes.length; i++ ) {
      if( elm.style[ domPrefixes[i] + &apos;AnimationName&apos; ] !== undefined ) {
        pfx = domPrefixes[ i ]
        animationstring = pfx + &apos;Animation&apos;
        keyframeprefix = &apos;-&apos; + pfx.toLowerCase() + &apos;-&apos;
        animationstartevent = startEvents[ i ]
        animation = true
        break
      }
    }
  }

  let animationName = &apos;resizeanim&apos;
  let animationKeyframes = &apos;@&apos; + keyframeprefix + &apos;keyframes &apos; + animationName + &apos; { from { opacity: 0; } to { opacity: 0; } } &apos;
  let animationStyle = keyframeprefix + &apos;animation: 1ms &apos; + animationName + &apos;; &apos;
}

const createStyles = function() {
  if (!stylesCreated) {
    //opacity:0 works around a chrome bug https://code.google.com/p/chromium/issues/detail?id=286360
    let css = `${(animationKeyframes ? animationKeyframes : &apos;&apos;)}.resize-triggers { ${(animationStyle ? animationStyle : &apos;&apos;)}visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers &gt; div, .contract-trigger:before { content: \&quot; \&quot;; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers &gt; div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }`
    let head = document.head || document.getElementsByTagName(&apos;head&apos;)[0]
    let style = document.createElement(&apos;style&apos;)

    style.type = &apos;text/css&apos;
    if (style.styleSheet) {
      style.styleSheet.cssText = css
    } else {
      style.appendChild(document.createTextNode(css))
    }

    head.appendChild(style)
    stylesCreated = true
  }
}

const addResizeListener = function(element, fn){
  if (attachEvent) element.attachEvent(&apos;onresize&apos;, fn)
  else if(IS_BROWSER) {
    if (!element.__resizeTriggers__) {
      if (getComputedStyle(element).position == &apos;static&apos;) element.style.position = &apos;relative&apos;
      createStyles()
      element.__resizeLast__ = {}
      element.__resizeListeners__ = [];
      (element.__resizeTriggers__ = document.createElement(&apos;div&apos;)).className = &apos;resize-triggers&apos;
      element.__resizeTriggers__.innerHTML = &apos;&lt;div class=&quot;expand-trigger&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&apos; +
                                          &apos;&lt;div class=&quot;contract-trigger&quot;&gt;&lt;/div&gt;&apos;
      element.appendChild(element.__resizeTriggers__)
      resetTriggers(element)
      element.addEventListener(&apos;scroll&apos;, scrollListener, true)

      /* Listen for a css animation to detect element display/re-attach */
      animationstartevent &amp;&amp; element.__resizeTriggers__.addEventListener(animationstartevent, function(e) {
        if(e.animationName == animationName)
          resetTriggers(element)
      })
    }
    element.__resizeListeners__.push(fn)
  }
}

const removeResizeListener = function(element, fn){
  if (attachEvent) element.detachEvent(&apos;onresize&apos;, fn)
  else if(IS_BROWSER) {
    element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn), 1)
    if (!element.__resizeListeners__.length) {
        element.removeEventListener(&apos;scroll&apos;, scrollListener, true)
        element.__resizeTriggers__ = !element.removeChild(element.__resizeTriggers__)
    }
  }
}

export { addResizeListener, removeResizeListener }
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
